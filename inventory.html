<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inventory</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; padding:16px; }
    header a { text-decoration:none; }
    .card { background:#1e1f24; color:#fff; padding:12px; border-radius:10px; margin:10px 0; }
    .row { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .meta { opacity:.8; font-size:.9rem; }
    button { padding:6px 10px; border-radius:8px; border:none; cursor:pointer; }
    .qty { min-width:3rem; text-align:center; font-weight:700; }
    .danger { background:#b02020; color:#fff; }
    .ok { background:#2f7d32; color:#fff; }
    .ghost { background:#2a2c33; color:#fff; }
  </style>
</head>
<body>
  <header>
    <a href="./">← Back</a>
    <h2>Inventory</h2>
    <div class="meta">Tap +/– to adjust quantity. Items below minimum show red.</div>
  </header>

  <div id="list">Loading…</div>

  <script type="module">
  import { db } from './firebase.js';
  import {
    collection, doc, onSnapshot, updateDoc, increment
  } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';

  const list = document.querySelector('#list');

  // Basic styles for low-stock
  const style = document.createElement('style');
  style.textContent = `
    .item { display:flex; align-items:center; gap:12px; margin:10px 0; }
    .name { font-weight:600; }
    .qty  { min-width:3ch; text-align:center; display:inline-block; }
    .meta { opacity:.7; font-size:.9em; }
    .low  { color:#b00020; font-weight:700; } /* red when qty < min */
    button { padding:2px 8px; }
  `;
  document.head.appendChild(style);

  // Live subscribe so the list updates as you tap +/-
  onSnapshot(collection(db, 'inventory'), (snap) => {
    const items = snap.docs.map(d => ({ id: d.id, ...d.data() }))
                           .sort((a,b) => a.name.localeCompare(b.name));
    list.innerHTML = '';
    items.forEach(renderItem);
  });

  function renderItem(item) {
    const el = document.createElement('div');
    el.className = 'item';

    const low = Number(item.quantity ?? 0) < Number(item.minQty ?? 0);

    el.innerHTML = `
      <span class="name ${low ? 'low':''}">${item.name || item.partNumber || item.id}</span>
      <span class="meta">(${item.partNumber || ''})</span>
      <button class="dec">-</button>
      <span class="qty ${low ? 'low':''}">${item.quantity ?? 0}</span>
      <button class="inc">+</button>
      <span class="meta">Min: ${item.minQty ?? 0}</span>
    `;

    el.querySelector('.inc').addEventListener('click', () => bump(item.id, +1));
    el.querySelector('.dec').addEventListener('click', () => bump(item.id, -1));
    list.appendChild(el);
  }

  async function bump(id, delta) {
    const ref = doc(db, 'inventory', id);
    await updateDoc(ref, { quantity: increment(delta) });
  }
</script>
</body>
</html>
