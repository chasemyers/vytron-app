<!doctype html>
<html lang="en">
<head>
  <script>const appVersion='v=3';</script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vytron • Equipment</title>

  <link rel="stylesheet" href="./style.css?v=3" />
  <link rel="icon" href="data:,">
</head>
<body>
  <main class="card">
    <div id="out">Loading…</div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYA7OzOQBpyHsOYIDK89Z4-8BbrRleZ7A",
      authDomain: "vytron-maintenance-app.firebaseapp.com",
      projectId: "vytron-maintenance-app"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const out = document.getElementById("out");
    const id = new URLSearchParams(location.search).get("id");

    if (!id){
      out.innerHTML = `<div class="meta">No equipment id supplied.</div>
        <p><a href="./index.html">Back to list</a></p>`;
    } else {
      const snap = await getDoc(doc(db,"equipment",id));
      if (!snap.exists()){
        out.innerHTML = `<div>Item not found: <b>${id}</b></div>
          <p><a href="./index.html">Back to list</a></p>`;
      } else {
        const d = snap.data();
        out.innerHTML = `
          <h2>${d.name || "(unnamed)"} • ${id}</h2>
          <nav style="margin:8px 0;display:flex;gap:10px;">
            <a href="./index.html">Home</a>
            <a href="./inventory.html">Inventory</a>
            <a href="./pm.html">PM</a>
          </nav>
          <div class="kv"><b>Line:</b> ${d.line||""} &nbsp; <b>Station:</b> ${d.station||""}</div>
          <div class="kv"><b>Make/Model:</b> ${d.make||""} ${d.model||""}</div>
          <div class="kv"><b>Serial:</b> ${d.serial||""}</div>
          <div class="kv"><b>Location:</b> ${d.location||""}</div>
          ${d.notes ? `<div class="kv"><b>Notes:</b> ${d.notes}</div>` : ``}
          <p style="margin-top:14px">
            <a href="./index.html">← Back to list</a> &nbsp; &nbsp;
            <a href="./index.html?edit=${encodeURIComponent(id)}#form">Edit this item</a>
          </p>
        `;
      }
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      document.querySelectorAll('a[href$=".html"], a[href^="./index.html?edit"]').forEach(a=>{
        const u=new URL(a.getAttribute('href'), location.href);
        if(!u.search) u.search = appVersion; else u.search += '&'+appVersion;
        a.setAttribute('href', u.pathname + u.search + u.hash);
      });
    });
  </script>
</body>
</html>
